<?xml version="1.0" encoding="ISO-8859-15" standalone="no"?>
<uc-export clientvers="11.0.0">
  <JOBS_CIT AttrType="CIT" name="PCK.AUTOMIC_CA_RA.PUB.ACTION.RUN_DEPLOYMENT_PLAN">
    <XHEADER state="1">
      <Title>Run Deployment Plan</Title>
      <ArchiveKey1 />
      <ArchiveKey2 />
      <Active>1</Active>
      <OH_SubType />
      <CustomAttributes KeyListID="0" dataRequestID="0" />
    </XHEADER>
    <OUTPUTREG state="1">
      <FileReg />
    </OUTPUTREG>
    <SYNCREF state="1">
      <Syncs />
    </SYNCREF>
    <ATTR_JOBS state="1">
      <Queue>CLIENT_QUEUE</Queue>
      <StartType />
      <HostDst>|&lt;CIT&gt;|HOST</HostDst>
      <HostATTR_Type>CIT</HostATTR_Type>
      <CodeName />
      <Login />
      <IntAccount />
      <ExtRepDef>1</ExtRepDef>
      <ExtRepAll>0</ExtRepAll>
      <ExtRepNone>0</ExtRepNone>
      <AutoDeactNo>0</AutoDeactNo>
      <AutoDeact1ErrorFree>0</AutoDeact1ErrorFree>
      <AutoDeactErrorFree>1</AutoDeactErrorFree>
      <DeactWhen>ANY_OK</DeactWhen>
      <DeactDelay>0</DeactDelay>
      <AutoDeactAlways>0</AutoDeactAlways>
      <AttDialog>0</AttDialog>
      <ActAtRun>1</ActAtRun>
      <Consumption>0</Consumption>
      <UC4Priority>0</UC4Priority>
      <MaxParallel2>0</MaxParallel2>
      <MpElse1>0</MpElse1>
      <MpElse2>1</MpElse2>
      <TZ />
    </ATTR_JOBS>
    <ATTR_CIT state="1">
      <OutputDb>1</OutputDb>
      <OutputDbErr>0</OutputDbErr>
      <OutputFile>0</OutputFile>
      <OptReportPLOG>1</OptReportPLOG>
      <RequTaskParams>0</RequTaskParams>
    </ATTR_CIT>
    <CIT state="2">
      <citcont agentname="&lt;CIT&gt;" jobtype="WEBSERVICEREST" text="Web Service Rest">
        <cit cittype="2" icon="" id="" subtype="REST" text="REST Web Service">
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_aws_accesskey" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_aws_secret_accesskey" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_aws_sign_version" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_basic_host" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_basic_password" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_basic_port" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_basic_preemptive" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_basic_realm" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_basic_username" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_method" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_oauth_clientkey" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_oauth_clientsecret" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_oauth_refresh_token" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_oauth_refresh_uri" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_oauth_signature_type" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_oauth_token" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_oauth_token_secret" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_oauth_verifier" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_auth_oauth_version_method" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_connection_timeout" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_endpoint_url" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_follow_redirects" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_from_prompts" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_proxy_auth_method" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_proxy_host" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_proxy_password" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_proxy_port" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_proxy_realm" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_proxy_type" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_proxy_username" />
          <component con="0" enc="0" type="2" value="" xmlName="conn_read_timeout" />
          <component con="0" enc="0" type="2" value="30" xmlName="connectTimeout" />
          <component con="0" enc="0" type="2" value="" xmlName="curl" />
          <component con="0" enc="0" type="2" value="" xmlName="file" />
          <component con="0" enc="0" type="2" value="false" xmlName="isCurl" />
          <component con="0" enc="0" type="2" value="false" xmlName="jobHeaders" />
          <component con="0" enc="0" type="2" value="false" xmlName="jobQuery" />
          <component con="0" enc="0" type="2" value="application/json" xmlName="mediaType" />
          <component con="0" enc="0" type="2" value="POST" xmlName="method" />
          <component con="0" enc="0" type="2" value="false" xmlName="multiPart" />
          <component con="0" enc="0" type="2" value="false" xmlName="multiPartResp" />
          <component con="0" enc="0" type="2" value="Part 1" xmlName="partName" />
          <component con="0" enc="0" type="2" value="application/json" xmlName="request_part_0_mediaType" />
          <component con="0" enc="0" type="2" value="Part 1" xmlName="request_part_0_partName" />
          <component con="0" enc="0" type="2" value="text" xmlName="request_part_0_requestDataSource" />
          <component con="0" enc="0" type="2" value="A&amp;JSON#" xmlName="request_part_0_requestTab_data_1" />
          <component con="0" enc="0" type="2" value="text" xmlName="requestDataSource" />
          <component con="0" enc="0" type="2" value="false" xmlName="requestReports" />
          <component con="0" enc="0" type="2" value="&amp;UC4RB_CA_RA_VERSION#/run-deployment-plan" xmlName="resource" />
          <component con="0" enc="0" type="2" value="" xmlName="response_part_0_file" />
          <component con="0" enc="0" type="2" value="$.deploymentResults[*].id" xmlName="response_part_0_script_0_code_0" />
          <component con="0" enc="0" type="2" value="JSONPath" xmlName="response_part_0_script_0_queryType" />
          <component con="0" enc="0" type="2" value="UC4RB_CA_RA_DEPLOYMENT_IDS#" xmlName="response_part_0_script_0_resourceName" />
          <component con="0" enc="0" type="2" value="variable" xmlName="response_part_0_script_0_saveTo" />
          <component con="0" enc="0" type="2" value="false" xmlName="response_part_0_script_0_useArray" />
          <component con="0" enc="0" type="2" value="false" xmlName="responseReport" />
          <component con="0" enc="0" type="2" value="60" xmlName="responseTimeout" />
          <component con="0" enc="0" type="2" value="true" xmlName="responseToJobLog" />
          <component con="1" enc="0" type="2" value="" xmlName="restConnection" />
          <component con="0" enc="0" type="2" value="false" xmlName="tracePerformance" />
          <component con="0" enc="0" type="2" value="" xmlName="uriOverride" />
        </cit>
        <cit cittype="3" icon="" id="" subtype="GENERALJOBPANELDEF" text="General Job Panel" />
      </citcont>
    </CIT>
    <RUNTIME state="1">
      <MaxRetCode>0</MaxRetCode>
      <MrcExecute />
      <MrcElseE>0</MrcElseE>
      <FcstStatus>0| |</FcstStatus>
      <ErtMethodDef>1</ErtMethodDef>
      <ErtMethodFix>0</ErtMethodFix>
      <ErtFix>0</ErtFix>
      <ErtDynMethod>2|Average</ErtDynMethod>
      <ErtMethodDyn>0</ErtMethodDyn>
      <ErtCnt>0</ErtCnt>
      <ErtCorr>0</ErtCorr>
      <ErtIgn>0</ErtIgn>
      <ErtIgnFlg>0</ErtIgnFlg>
      <ErtMinCnt>0</ErtMinCnt>
      <MrtMethodNone>1</MrtMethodNone>
      <MrtMethodFix>0</MrtMethodFix>
      <MrtFix>0</MrtFix>
      <MrtMethodErt>0</MrtMethodErt>
      <MrtErt>0</MrtErt>
      <MrtMethodDate>0</MrtMethodDate>
      <MrtDays>0</MrtDays>
      <MrtTime>00:00</MrtTime>
      <MrtTZ />
      <SrtMethodNone>1</SrtMethodNone>
      <SrtMethodFix>0</SrtMethodFix>
      <SrtFix>0</SrtFix>
      <SrtMethodErt>0</SrtMethodErt>
      <SrtErt>0</SrtErt>
      <MrtCancel>0</MrtCancel>
      <MrtExecute>0</MrtExecute>
      <MrtExecuteObj />
    </RUNTIME>
    <DYNVALUES state="1">
      <dyntree>
        <node content="1" id="VALUE" name="Variables" parent="" type="VALUE">
          <VALUE state="1">
            <Values>
              <row ERTUsage="0" Name="&amp;UC4RB_CA_RA_DEPLOYMENT_IDS#" Value="" />
            </Values>
            <Mode>0</Mode>
          </VALUE>
        </node>
        <node content="1" id="PCK.AUTOMIC_CA_RA.PUB.PROMPTSET.CONNECT_TO_CA_RA" name="PCK.AUTOMIC_CA_RA.PUB.PROMPTSET.CONNECT_TO_CA_RA" parent="PRPTS" type="PROMPTSET">
          <PROMPTSET name="PCK.AUTOMIC_CA_RA.PUB.PROMPTSET.CONNECT_TO_CA_RA" ontop="1">
            <PRPTBOX promptset="PCK.AUTOMIC_CA_RA.PUB.PROMPTSET.CONNECT_TO_CA_RA" prptmode="1">
              <UC4RB_CA_RA_URLs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_VERSIONs.00 altview="0" haslist="0" />
            </PRPTBOX>
          </PROMPTSET>
        </node>
        <node content="1" id="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_AUTH_BASIC" name="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_AUTH_BASIC" parent="PRPTS" type="PROMPTSET">
          <PROMPTSET name="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_AUTH_BASIC" ontop="1">
            <PRPTBOX promptset="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_AUTH_BASIC" prptmode="1">
              <CONN_AUTH_BASIC_USERNAMEs.00 altview="0" haslist="0" />
              <CONN_AUTH_BASIC_PASSWORDs.00 altview="0" haslist="0">--1005C34E5F289263D0</CONN_AUTH_BASIC_PASSWORDs.00>
              <CONN_AUTH_BASIC_HOSTs.00 altview="0" haslist="0" />
              <CONN_AUTH_BASIC_PORTs.00 altview="0" haslist="0">0</CONN_AUTH_BASIC_PORTs.00>
              <CONN_AUTH_BASIC_REALMs.00 altview="0" haslist="0" />
              <CONN_AUTH_BASIC_PREEMPTIVEs.00 altview="0" haslist="0">YES</CONN_AUTH_BASIC_PREEMPTIVEs.00>
            </PRPTBOX>
          </PROMPTSET>
        </node>
        <node content="1" id="PCK.AUTOMIC_CA_RA.PRV.PROMPTSET.RUN_DEPLOYMENT_PLAN" name="PCK.AUTOMIC_CA_RA.PRV.PROMPTSET.RUN_DEPLOYMENT_PLAN" parent="PRPTS" type="PROMPTSET">
          <PROMPTSET name="PCK.AUTOMIC_CA_RA.PRV.PROMPTSET.RUN_DEPLOYMENT_PLAN" ontop="1">
            <PRPTBOX promptset="PCK.AUTOMIC_CA_RA.PRV.PROMPTSET.RUN_DEPLOYMENT_PLAN" prptmode="1">
              <UC4RB_CA_RA_DEPLOYMENTs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_DEPLOYMENT_DESCs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_DEPLOYMENT_STAGEs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_ENV_IDSs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_ENV_NAMESs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_APP_IDs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_APP_NAMEs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_ARTIFACT_PCKs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_ARTIFACT_PCK_FILEs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_BUILD_VERs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_DEP_PLANs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_DESCRIPTIONs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_DEP_PLAN_TYPEs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_DEP_TEMPLATEs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_PROJECTs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_DEP_TEMP_CAT_NAMEs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_DEP_TEMP_CAT_IDs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_PROPs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_MF_FILEs.00 altview="0" haslist="0" />
              <UC4RB_CA_RA_TIMEOUTs.00 altview="0" haslist="0">180</UC4RB_CA_RA_TIMEOUTs.00>
            </PRPTBOX>
          </PROMPTSET>
        </node>
        <node content="1" id="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_PROXY" name="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_PROXY" parent="PRPTS" type="PROMPTSET">
          <PROMPTSET name="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_PROXY" ontop="1">
            <PRPTBOX promptset="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_PROXY" prptmode="1">
              <CONN_PROXY_TYPEs.00 altview="0" haslist="0">None</CONN_PROXY_TYPEs.00>
              <CONN_PROXY_HOSTs.00 altview="0" haslist="0" />
              <CONN_PROXY_PORTs.00 altview="0" haslist="0">0</CONN_PROXY_PORTs.00>
              <CONN_PROXY_USERNAMEs.00 altview="0" haslist="0" />
              <CONN_PROXY_PASSWORDs.00 altview="0" haslist="0">--1005C34E5F289263D0</CONN_PROXY_PASSWORDs.00>
              <CONN_PROXY_REALMs.00 altview="0" haslist="0" />
              <CONN_PROXY_AUTH_METHODs.00 altview="0" haslist="0">None</CONN_PROXY_AUTH_METHODs.00>
            </PRPTBOX>
          </PROMPTSET>
        </node>
        <node content="1" id="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_ADVANCED" name="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_ADVANCED" parent="PRPTS" type="PROMPTSET">
          <PROMPTSET name="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_ADVANCED" ontop="1">
            <PRPTBOX promptset="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.CONNECTION_ADVANCED" prptmode="1">
              <CONN_CONNECTION_TIMEOUTs.00 altview="0" haslist="0">30</CONN_CONNECTION_TIMEOUTs.00>
              <CONN_READ_TIMEOUTs.00 altview="0" haslist="0">60</CONN_READ_TIMEOUTs.00>
              <CONN_FOLLOW_REDIRECTSs.00 altview="0" haslist="0">NO</CONN_FOLLOW_REDIRECTSs.00>
            </PRPTBOX>
          </PROMPTSET>
        </node>
        <node content="1" id="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.OVERWRITE_RA_AGENT" name="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.OVERWRITE_RA_AGENT" parent="PRPTS" type="PROMPTSET">
          <PROMPTSET name="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.OVERWRITE_RA_AGENT" ontop="1">
            <PRPTBOX promptset="PCK.AUTOMIC_RA_REST.PUB.PROMPTSET.OVERWRITE_RA_AGENT" prptmode="1">
              <OVERWRITE_RA_AGENT_PROMPTs.00 altview="1" haslist="0">&amp;OVERWRITE_RA_AGENT_PROMPT#</OVERWRITE_RA_AGENT_PROMPTs.00>
            </PRPTBOX>
          </PROMPTSET>
        </node>
      </dyntree>
    </DYNVALUES>
    <ROLLBACK state="1">
      <RollbackFlag>0</RollbackFlag>
      <CBackupObj />
      <CRollbackObj />
      <FBackupPath />
      <FDeleteBefore>0</FDeleteBefore>
      <FInclSubDirs>0</FInclSubDirs>
    </ROLLBACK>
    <PRE_SCRIPT mode="1" replacementmode="1" state="1">
      <PSCRI><![CDATA[:SET &CONN_ENDPOINT_URL# = &UC4RB_CA_RA_URL#
:INC PCK.AUTOMIC_RA_REST.PUB.INCLUDE.PREPARE_RA_JOB
:INC PCK.AUTOMIC_RA_REST.PUB.INCLUDE.SET_CONNECTION_AUTH_BASIC]]></PSCRI>
    </PRE_SCRIPT>
    <SCRIPT mode="1" state="1">
      <MSCRI><![CDATA[! Environment Names or Environment Ids Validation
:  SET &ENV_CHECK# = 0

:  IF &UC4RB_CA_RA_ENV_IDS# NE ""
:    SET &ENV_CHECK# = &ENV_CHECK# + 1
:  ENDIF

:  IF &UC4RB_CA_RA_ENV_NAMES# NE ""
:    SET &ENV_CHECK# = &ENV_CHECK# + 1
:  ENDIF

:     IF  &ENV_CHECK# EQ 2 OR 0
:         STOP MSG, 50, "Either provide Environment Names or Environment Ids."
:      ENDIF


! Application Name or Application ID Validation
:  SET &APP_CHECK# = 0

:  IF &UC4RB_CA_RA_APP_ID# NE ""
:    SET &APP_CHECK# = &APP_CHECK# + 1
:  ENDIF

:  IF &UC4RB_CA_RA_APP_NAME# NE ""
:    SET &APP_CHECK# = &APP_CHECK# + 1
:  ENDIF

:     IF  &APP_CHECK# EQ 2 OR 0
:         STOP MSG, 50, "Either provide Application Name or Application ID."
:      ENDIF


! Template Category Name or Template Category ID Validation
:  SET &TMP_CHECK# = 0

:  IF &UC4RB_CA_RA_DEP_TEMP_CAT_ID# NE ""
:    SET &TMP_CHECK# = &TMP_CHECK# + 1
:  ENDIF

:  IF &UC4RB_CA_RA_DEP_TEMP_CAT_NAME# NE ""
:    SET &TMP_CHECK# = &TMP_CHECK# + 1
:  ENDIF

:     IF  &TMP_CHECK# EQ 2 OR 0
:         STOP MSG, 50, "Either provide Template Category Name or Template Category ID."
:      ENDIF

! Building JSON Object
:  SET &JSON# = "{"

!   Deployment Name
:   SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_DEPLOYMENT#
:   INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:   SET &JSON# =  STR_CAT(&JSON#, '"deployment":"&UC4RB_ESCAPED_STRING#"')

!  Deployment Description
:  IF &UC4RB_CA_RA_DEPLOYMENT_DESC# <> ""
:      SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_DEPLOYMENT_DESC#
:      INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:      SET &JSON# =  STR_CAT(&JSON#, ',"deploymentDescription":"&UC4RB_ESCAPED_STRING#"')
:   ENDIF

!  Deployment Stage To Perform
:  IF &UC4RB_CA_RA_DEPLOYMENT_STAGE# <> ""
:      SET &JSON# =  STR_CAT(&JSON#, ',"deploymentStageToPerform":"&UC4RB_CA_RA_DEPLOYMENT_STAGE#"')
:   ENDIF

!  Environment Ids OR Environment Names
:  IF &UC4RB_CA_RA_ENV_IDS# <> ""
:      SET &JSON# = STR_CAT(&JSON#, ',"environmentIds":[')
:      SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_ENV_IDS#
:      INC PCK.AUTOMIC_CA_RA.PRV.INCLUDE.PREPARE_ARRAY_STRING
:      SET &JSON# = STR_CAT(&JSON#, '"&STR_ARRAY#"]')
:  ELSE
:      SET &JSON# = STR_CAT(&JSON#, ',"environments":[')
:      SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_ENV_NAMES#
:      INC PCK.AUTOMIC_CA_RA.PRV.INCLUDE.PREPARE_ARRAY_STRING
:      SET &JSON# = STR_CAT(&JSON#, '"&STR_ARRAY#"]')
:  ENDIF

!  Application ID OR Application Name
:  IF &UC4RB_CA_RA_APP_ID# <> ""
:      SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_APP_ID#
:      INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:      SET &JSON# =  STR_CAT(&JSON#, ',"applicationId":"&UC4RB_ESCAPED_STRING#"')
:  ELSE
:     SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_APP_NAME#
:     INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:     SET &JSON# =  STR_CAT(&JSON#, ',"application":"&UC4RB_ESCAPED_STRING#"')
:  ENDIF

!  Artifact Package Name
:  IF &UC4RB_CA_RA_ARTIFACT_PCK# <> ""
:      SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_ARTIFACT_PCK#
:      INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:     SET &JSON# =  STR_CAT(&JSON#, ',"artifactPackage":"&UC4RB_ESCAPED_STRING#"')
:   ENDIF

!  Read Artifact Package As XML file to String
:  IF &UC4RB_CA_RA_ARTIFACT_PCK_FILE# NE ""
:    SET &UC4RB_CA_RA_ARTIFACT_CONTENT# =""
:    SET &HND# = PREP_PROCESS_FILE(&OVERWRITE_RA_AGENT#,&UC4RB_CA_RA_ARTIFACT_PCK_FILE#,,,,)
:    PROCESS &HND#
:      SET &LINE#=GET_PROCESS_LINE(&HND#)
:      SET &UC4RB_CA_RA_ARTIFACT_CONTENT# = STR_CAT(&UC4RB_CA_RA_ARTIFACT_CONTENT#, &LINE#)
:    ENDPROCESS
:    CLOSE_PROCESS &HND#
:    SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_ARTIFACT_CONTENT#
:    INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:    SET &JSON# =  STR_CAT(&JSON#, ',"artifactPackageAsXML" : "&UC4RB_ESCAPED_STRING#"')
:  ENDIF

!   Build Version Name
:   SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_BUILD_VER#
:   INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:   SET &JSON# =  STR_CAT(&JSON#, ',"build":"&UC4RB_ESCAPED_STRING#"')

!   Deployment Plan Name
:   SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_DEP_PLAN#
:   INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:   SET &JSON# =  STR_CAT(&JSON#, ',"deploymentPlan":"&UC4RB_ESCAPED_STRING#"')

!   Deployment Plan Type
:   IF &UC4RB_CA_RA_DEP_PLAN_TYPE# NE ""
:      SET &JSON# =  STR_CAT(&JSON#, ',"deploymentPlanType":"&UC4RB_CA_RA_DEP_PLAN_TYPE#"')
:    ENDIF

!   Deployment Template Name
:   SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_DEP_TEMPLATE#
:   INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:   SET &JSON# =  STR_CAT(&JSON#, ',"deploymentTemplate":"&UC4RB_ESCAPED_STRING#"')


!  Description
:  IF &UC4RB_CA_RA_DESCRIPTION# <> ""
:      SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_DESCRIPTION#
:      INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:     SET &JSON# =  STR_CAT(&JSON#, ',"deploymentPlanDescription":"&UC4RB_ESCAPED_STRING#"')
:   ENDIF

!   Project Name
:   SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_PROJECT#
:   INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:   SET &JSON# =  STR_CAT(&JSON#, ',"project":"&UC4RB_ESCAPED_STRING#"')

!  Template Category ID OR Template Category Name
:  IF &UC4RB_CA_RA_DEP_TEMP_CAT_ID# <> ""
:      SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_DEP_TEMP_CAT_ID#
:      INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:      SET &JSON# =  STR_CAT(&JSON#, ',"templateCategoryId":"&UC4RB_ESCAPED_STRING#"')
:  ELSE
:     SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_DEP_TEMP_CAT_NAME#
:     INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:     SET &JSON# =  STR_CAT(&JSON#, ',"templateCategory":"&UC4RB_ESCAPED_STRING#"')
:  ENDIF

!  Properties
:  IF &UC4RB_CA_RA_PROP# <> ""
:      SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_PROP#
:      INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:      SET &JSON# = STR_CAT(&JSON#, ',"properties":{')
:       DEFINE &PROPS#, string, 50
:       DEFINE &KEY_VAL#, string, 2
:       FILL &PROPS#[] = STR_SPLIT(&UC4RB_ESCAPED_STRING#,",")
:       SET &LEN# = LENGTH(&PROPS#[],SIZE)
:       SET &VAR# = 1

:       WHILE &VAR# LE &LEN#
:          SET &PROP# = STR_TRIM(&PROPS#[&VAR#])
:          SET &VAR# = &VAR#+ 1
:           FILL &KEY_VAL#[] = STR_SPLIT(&PROP#,":")
:          SET &COUNT# = 1
:          SET &KEY# = STR_TRIM(&KEY_VAL#[&COUNT#])
:          SET &COUNT# = &COUNT# + 1
:          SET &VAL# = STR_TRIM(&KEY_VAL#[&COUNT#])
:          IF "" NE &KEY# OR  &VAL#
:            SET &JSON# = STR_CAT(&JSON#, '"&KEY#":"&VAL#",')
:          ENDIF
:        ENDWHILE
:        SET &CHECK#=STR_ENDS_WITH(&JSON#, ",")
:       IF &CHECK# EQ "Y"
:          SET &number# = STR_LENGTH(&JSON#)
:          SET &number# =  &number# -1
:          SET &JSON# = SUBSTR(&JSON#,1, &number#)
:       ENDIF
:      SET &JSON# =  STR_CAT(&JSON#, '}')
:   ENDIF

! Read manifest file to String
:   IF &UC4RB_CA_RA_MF_FILE# NE ""
:     SET &UC4RB_CA_RA_MF_CONTENT# = ""
:     SET &HND# = PREP_PROCESS_FILE(&OVERWRITE_RA_AGENT#,&UC4RB_CA_RA_MF_FILE#,,,,)
:     PROCESS &HND#
:       SET &LINE#=GET_PROCESS_LINE(&HND#)
:       SET &UC4RB_CA_RA_MF_CONTENT# = STR_CAT(&UC4RB_CA_RA_MF_CONTENT#, &LINE#)
:     ENDPROCESS
:     CLOSE_PROCESS &HND#
:     SET &UC4RB_ESCAPED_STRING# = &UC4RB_CA_RA_MF_CONTENT#
:     INC PCK.AUTOMIC_CA_RA.PUB.INCLUDE.ESCAPE_ARG_VALUE
:     SET &JSON# =  STR_CAT(&JSON#, ',"manifest" : "&UC4RB_ESCAPED_STRING#"')
:   ENDIF

!  Timeout (Sec)
:  SET &JSON# =  STR_CAT(&JSON#, ',"timeout":"&UC4RB_CA_RA_TIMEOUT#"')

: SET &JSON# =  STR_CAT(&JSON#, '}')]]></MSCRI>
    </SCRIPT>
    <OUTPUTSCAN state="1">
      <Inherit>N</Inherit>
      <filterobjects>
        <row Icon="FILTER" condition="true" execute="" filter="PCK.AUTOMIC_CA_RA.PUB.FILTER.CHECK_STATUS" lnr="1" return="9" statustext="" />
      </filterobjects>
      <HostFsc />
      <LoginFsc />
    </OUTPUTSCAN>
    <POST_SCRIPT mode="1" replacementmode="1" state="1">
      <OSCRI><![CDATA[:PUBLISH &UC4RB_CA_RA_DEPLOYMENT_IDS#,,"TASK"]]></OSCRI>
    </POST_SCRIPT>
    <DOCU_Docu state="1" type="text">
      <DOC><![CDATA[= Action name =
PCK.AUTOMIC_CA_RA.PUB.ACTION.RUN_DEPLOYMENT_PLAN

= General description =
Creates a deployment plan from an existing deployment template. An existing artifact package (by name) or a new one (supplied by XML) could be assigned to the deployment plan. The deployment plan is also assigned an artifact package, when supplied the artifact package name. The deployment plan can also load a manifest file when supplied one.


= Inputs =
- Deployment Name* 			: Provide Deployment name. E.g. CustomDeployment (Mandatory field)
- Deployment Description 		: Provide Deployment description. E.g. Rest Deployment  (Optional field)
- Deployment Stage To Perform 	: Execute the stage after deployment has been created. All the stages preceding are executed. Stages - {None, Initialization, Validation, Approval-Gate, Distribute-Execution-Server, Distribute-Agent, Deployment, Post-Deployment}. Note: If [None] is selected, the deployment is only created. If no deploymentStageToPerform is specified, all the stages are run.(Optional field)
- Environment Ids* 				: List of environment ids the deployment runs on. E.g. 1,3 (Conditional Field)
- Environment Names* 			: List of environment names the deployment runs on. E.g. Dev, Test (Conditional Field)
- Application ID*				: Provide an application Id for this deployment plan. E.g. 311 (Conditional Field)
- Application Name*			: Provide an application name for this deployment plan. E.g. Sample Application (Conditional Field)
- Artifact Package Name 		:  Provide artifact package name to be assigned to the deployment plan. E.g. Sample Artifact Package (Optional field)
-  Artifact Package As XML              : Artifact Package XML file to be uploaded including the full path. E.g. C:\manifest\package.xml (Optional field)
-  Build Version Name*	 		:  Provide name of the build version. E.g. customBuild1.0 (Mandatory field)
-  Deployment Plan Name*		: Provide name for the deployment plan. E.g. myCustomDeployment (Mandatory field)
-  Description  				        : Provide description for deployment plan. E.g. Sample description (Optional field)
- Deployment Plan Type   		: Deployment plan type. Can be MINOR, MAJOR or EMERGENCY. If the type is not supplied, the plan is marked MAJOR. (Optional field)
-  Deployment Template Name*	:  Provide deployment template name. E.g. deploymentTemplate (Mandatory field)
-  Project Name*                : Provide project name. If the project is not existing it will be created. E.g. testProject ((Mandatory field))
-  Template Category Name* 		: Provide template category name. E.g. testTemplate (Conditional Field)
-  Template Category ID*   		: Provide template category ID. E.g. 101 (Conditional Field)
- Properties                                      : A map of {name, value} property pairs. If supplied, updates the property values for the deployment plan. E.g. Prop1:Val1, Prop2:Val2. Note: The property name must exist in the template.(Optional field)
-  Manifest File  				: Manifest XML file to be uploaded including the full path. If supplied, the parameters values (in release scope) is loaded into the deployment plan. E.g. C:\manifest\manifest.xml (Optional field)
-  Timeout (Sec) 				: If there is a pre int stage & its running exceeds the timeout, the result of the rest call fails although the pre-int stage will not be stopped. E.g. 300 (Optional field)


= Conditional Field =
* Environments may be provided in one of the following ways:
	- Environment Names list
	- Environment Ids list 
* The application in one of the following ways:
	- Application ID
	- Application Name
* Specify a template category in one of the following ways:
	- Template Category ID 
	- Template Category Name

= Failure Conditions =
* If version Id is lower than v3 or not provided.
* If both or none of [Application ID and Application Name] are provided.
* If both or none of [Template Category Name and Template Category ID] are provided.
* If both or none of [Environment Names and Environment Ids] are provided.

= Behavior =
* if the project doesn't exist it will be created.
* If deployment already existing and deployment plan does,t deployment plan will be created. 

=Return Value=
UC4RB_CA_RA_DEPLOYMENT_IDS#    : Comma separated run IDs of the deployment plan.

= Outputs =
* Return code is 0 in case of success.
* Return code is non-zero in case of failure.

= Rollback =
(none)

= Logging =
AE logs will be displayed in the AE report.

]]></DOC>
    </DOCU_Docu>
  </JOBS_CIT>
</uc-export>